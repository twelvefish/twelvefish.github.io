# TCP/IP協定

幾乎所有網路都使用TCP/IP協定

## TCP/IP協定可分為四層

- 應用層 (application layer):為TCP/IP的最上一層，讓應用程式透過服務與協定來交換資料

常用的應用層協定:
	- HTTP: www傳送檔案的規則	port:80
	- FTP: 主機與網路間的傳輸資料協定	port:20、21
	- SMTP: 傳送、接收、轉寄電子郵件	port:25
	- POP3: 主從式協定，定義Server如何為使用者接收、儲存電子郵件	port:110
	- Telnet: 互動式終端機的模擬協定	port:23
	- DNS: 在網路上將網域名稱轉換為IP位址	port:53
	- HTTPS: 有加密的www port:443
	
port: 讓主機之間能夠通訊的地址，要開始通訊的一方指出要求的通訊port，若對方的這個port可以使用，則雙方開始通訊，port存在TCP封包的表頭內

- 傳輸層 (transport layer): 定義應用程式之間的資料傳輸，提供流量控制、錯誤偵測與修正

常用的傳輸層協定:
	- TCP: 建立可靠的一對一連結，確定兩端都接收到每一個封包，同時封包被正確解碼與排序，TCP傳輸期間是持續的但是傳輸結束就中斷
	
	- UDP: 提供非可靠性、非連結性的通訊，不確定每一個封包都能送達，傳輸速度快，適合小封包傳輸

- 網際網路層 (Internet layer): 負責安排路徑、設定IP位址與封裝

常用的網際網路層協定:
	- IP協定: 設定主機位址，並負責切割與重組封包
	- ARP協定: 負責把IP位址轉換為下一層網路介面層的MAC位址
	- ICMP協定: 提供維護與報告功能，ex:Ping為ICMP指令之一，可以檢查兩個系統之間的連結狀態
	- IGMP協定: 負責管理IP多接收者傳播(multicast)的群組

- 網路介面層 (network interface layer): 負責在實體的網路上收發封包，讓不同的網路架構可以同時存在

>圖

## TCP/IP各層的關係可藉由資料封裝(encapsulation)表示

- 一封電子郵件被加上TCP表頭(header)與錯誤檢查碼後封裝為TCP封包
- 再加上IP位址等表頭資訊後封裝為IP封包
- 最後轉換為硬體網路上的0或1來進行傳輸
- 接收者最後依反向進行處理，就得到最後原來資料，一封電子郵件

## TCP 三向握手

## TCP/IP的攻擊手法

最常發生於傳輸層和網際網路層，可藉由安裝WireShark看到封包傳遞過程及資訊

- 駭客利用Telnet指令就可以針對port進行掃描
 ex:要檢查一台Server是否提供電子郵件服務，可以對它發出 telnet www.google.com 25 指令，如果這台Server提供SMTP服務，就會回應登入訊息，將port掃描擴大，就可以勾勒出Server的網路結構，作為攻擊的參考
 
- SYN洪水攻擊(SYN flood attack): 藉由TCP三向握手，駭客一直對特定對象發送SYN請求，卻不回應後面的ACK，那麼接收端就會不停累積連線要求卻無法消化，其他有需要的連線反而遭到阻擋，形成DOS

- 序號預測攻擊: TCP封包傳送是有決定順序的，在網路上監聽的駭客，藉由搶先發出相同序號的假冒封包，阻擾真正的封包

- TCP/IP劫持 (TCP/IP hijacking): 一位使用者從遠端以telnet存取Server，駭客劫持這條連線，就能不經過登入程序入侵Server，成為隱藏的中間人，以便進行竄改雙方之間的通訊

### 串聯手法

- 駭客先進行網路監聽 (偵查)
- 對網路進行有系統的port掃描 (測試)
- 發現弱點時，如果系統有提供外部客戶telnet服務，以SYN洪水攻擊堵住客戶端
- 再用序號預測攻擊讓Server接受對話 (侵入)
- 接著就可以劫持TCP/IP
- 以取代真的客戶端進行telnet存取Server (控制)
- Server成功被駭客所駭 (利用與轉戰)
 
