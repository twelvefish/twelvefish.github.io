## 谷粒商城

## 簡介

## 第1章、環境搭建

1、使用vagrant快速安裝Linux虛擬機

- 這裡採用安裝VM Virtualbox
- 項目中 redis、MySQL、RabbitMQ都是安裝在linux裡面
- 使用vagrant進行虛擬機建置
- 安装Centos7
    - vagrant init centos/7
    - ![](/img/谷粒商城/01.PNG)
- 啟動虛擬機
    - vagrant up
- 連線到虛擬機
    - vagrant ssh
- 重啟虛擬機
    - vagrant reload
- 修改網路配置
    - C槽:使用者，路徑下的 Vagrantfile
    - ![](/img/谷粒商城/04.PNG)
    - Ip位置參考網路連線VirtualBox配到的IP，前三碼要一致，最後一碼不用
    - 將 config.vm.network "private_network", ip: "192.168.56.XX"
    - ![](/img/谷粒商城/02.PNG)
    - 測試本機和虛擬機互相ping是否能打通，確保網路能向虛擬機內部溝通
    - ![](/img/谷粒商城/03.PNG)
- 可直接切換root權限，密碼預設 vagrant
    - su root

2、安裝Docker

- 官方Docker於CentOS安裝教學
    - https://docs.docker.com/engine/install/centos/
- 將docker打開
    - sudo systemctl start docker
- docker版本
    - docker -v
- docker開機自啟
    - sudo systemctl enable docker
- docker裡面有哪些鏡像
    - sudo docker images

3、安裝mysql 5.7
- https://hub.docker.com/_/mysql
- 指定版本指令 sudo docker pull mysql:5.7
- 映射 mysql 路徑和 啟動 mysql
    - sudo docker run -p 3306:3306 --name mysql \
    -v /mydata/mysql/log:/var/log/mysql \
    -v /mydata/mysql/data:/var/lib/mysql \
    -v /mydata/mysql/conf:/etc/mysql/conf.d \
    -e MYSQL_ROOT_PASSWORD=root \
    -d mysql:5.7 
    - docker的3306端口和linux的3306端口對映
    - linux底下的資料夾/mydata/mysql 對映到 docker底下的對映路徑，用於方便看log等docker底下的資源
- 修改mysql配置，用於設定utf8，vi my.cnf
    - 指令
        [client]
        default-character-set=utf8
        [mysql]
        default-character-set=utf8
        [mysqld]
        init_connect='SET collation_connection = utf8_unicode_ci'
        init_connect='SET NAMES utf8'
        character-set-server=utf8
        collation-server=utf8_unicode_ci
        skip-character-set-client-handshake
        skip-name-resolve
- 重啟mysql
    - docker restart mysql
- 目前開啟的鏡像
    - docker ps
    - ![](/img/谷粒商城/05.PNG)

4、安裝 redis

- 和 mysql大同小異
- docker pull redis         
- docker run -p 6379:6379 --name redis \
    -v /mydata/redis/data:/data \
    -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \
    -d redis redis-server /etc/redis/redis.conf
- ![](/img/谷粒商城/06.PNG)
- 持久化redis，否則每次重啟資料就清空了
    - echo "appendonly yes"  >> /mydata/redis/conf/redis.conf
- 使用redis cli
    - docker exec -it redis redis-cli
- 設置持久化後，就算重啟redis，原本存放資料依然存在
    - ![](/img/谷粒商城/07.PNG)

5、用UI介面確認安裝的mysql和redis能夠訪問

- 每次重起虛擬機，docker會自動將mysql、redis啟動
    - sudo docker update redis --restart=always
    - sudo docker update mysql --restart=always
- ![](/img/谷粒商城/08.PNG)
- ![](/img/谷粒商城/09.PNG)
- ![](/img/谷粒商城/10.PNG)

6、異常狀況

- 磁碟空間被 vagrant 占滿了
    - 解決方法 https://www.cnblogs.com/nio-nio/p/13616415.html
## 第2章、微服務搭建

- 商品服務 product
- 倉儲服務 ware
- 訂單服務 order
- 優惠卷服務 coupon
- 用戶服務 member
- ![](/img/谷粒商城/11.PNG)


- lombok @Data 增加get set方法